# HBase

## 1. 准备资源

### 1.1 下载 HBase 源码

~~~shell
git clone https://github.com/apache/hbase.git
git checkout branch-2.5
~~~

### 1.2 pom.xml

~~~xml

~~~

### 1.3 修改源码

源码修改的部分，会在代码中出现 // DLC-FIX 注释，通过搜索可快速定位修改部分

| 序号 | 影响源           | 模块名                                   | 全类名                                                       |
| ---- | ---------------- | ---------------------------------------- | ------------------------------------------------------------ |
| 1    | guava            | [druid-handler](.\src-HIVE-3.1.3)        | org.apache.hadoop.hive.druid.serde.DruidScanQueryRecordReader |
| 2    | guava            | [llap-server](.\src-HIVE-3.1.3)          | org.apache.hadoop.hive.llap.daemon.impl.AMReporter           |
| 3    | guava            | [llap-server](.\src-HIVE-3.1.3)          | org.apache.hadoop.hive.llap.daemon.impl.LlapTaskReporter     |
| 4    | guava            | [llap-server](.\src-HIVE-3.1.3)          | org.apache.hadoop.hive.llap.daemon.impl.TaskExecutorService  |
| 5    | guava            | [ql](.\src-HIVE-3.1.3)                   | org.apache.hadoop.hive.ql.exec.tez.SampleTezSessionState     |
| 6    | guava            | [ql](.\src-HIVE-3.1.3)                   | org.apache.hadoop.hive.ql.exec.tez.WorkloadManager           |
| 7    | guava            | [llap-tez](.\src-HIVE-3.1.3)             | org.apache.hadoop.hive.llap.tezplugins.LlapTaskSchedulerService |
| 8    | guava            | [llap-common](.\src-HIVE-3.1.3)          | org.apache.hadoop.hive.llap.AsyncPbRpcProxy                  |
| 9    | spark            | [ql](.\src-HIVE-3.1.3)                   | org.apache.hadoop.hive.ql.stats.TestStatsUtils               |
| 10   | spark            | [spark-client](.\src-HIVE-3.1.3)         | org.apache.hive.spark.client.metrics.ShuffleWriteMetrics     |
| 11   | spark            | [spark-client](.\src-HIVE-3.1.3)         | org.apache.hive.spark.counter.SparkCounter                   |
| 12   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.ColumnsStatsUtils |
| 13   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.aggr.DateColumnStatsAggregator |
| 14   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.aggr.DecimalColumnStatsAggregator |
| 15   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.aggr.DoubleColumnStatsAggregator |
| 16   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.aggr.LongColumnStatsAggregator |
| 17   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.aggr.StringColumnStatsAggregator |
| 18   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.cache.DateColumnStatsDataInspector |
| 19   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.cache.DecimalColumnStatsDataInspector |
| 20   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.cache.DoubleColumnStatsDataInspector |
| 21   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.cache.LongColumnStatsDataInspector |
| 22   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.cache.StringColumnStatsDataInspector |
| 23   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.merge.DateColumnStatsMerger |
| 24   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.merge.DecimalColumnStatsMerger |
| 25   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.merge.DoubleColumnStatsMerger |
| 26   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.merge.LongColumnStatsMerger |
| 27   | metastore        | [standalone-metastore](.\src-HIVE-3.1.3) | org.apache.hadoop.hive.metastore.columnstats.merge.StringColumnStatsMerger |
| 28   | hbase            | [hbase-handler](.\src-HIVE-3.1.3)        | org.apache.hadoop.hive.hbase.HiveHBaseTableSnapshotInputFormat |
| 29   | javax.ws.rs.core | [hcatalog](.\src-HIVE-3.1.3)             | org.apache.hive.hcatalog.templeton.mock.MockUriInfo          |

## 2. 执行编译

### 2.1 修改配置

~~~shell
cd habse-branch-2.5
mvn clean package assembly:single -DskipTests
~~~



## 附录: 打包 DLC

解压编译后的包，并将目录命名：HIVE

编译后有两个 tar.gz 包，一个是 hive 主包，另一个是 standalone-metastore 包，为方便后续使用，会将  standalone-metastore 包中的内容解压出来后，重命名为 metastore 文件夹，并移动到 hive 主包目录中。

主包命名：dlc-hive-3.1.3.tar.gz

~~~shell
tar -zxf ./packaging/target/apache-hive-3.1.3-bin.tar.gz -C /data/install/
tar -zxf ./standalone-metastore/target/apache-hive-metastore-3.1.3-bin.tar.gz -C /data/install/
tar -zcf dlc-hive-3.1.3.tar.gz ./HIVE
~~~