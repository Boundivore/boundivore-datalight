datalight:
  service:
    name: YARN
    version: 3.2.4
    tgz: dlc-yarn-3.2.4.tar.gz
    conf-dirs:
      - service-conf-dir: '{{SERVICE_DIR}}/YARN/bin'
        templated-dir: '{{DATALIGHT_DIR}}/plugins/YARN/templated/bin'

      - service-conf-dir: '{{SERVICE_DIR}}/YARN/etc/hadoop'
        templated-dir: '{{DATALIGHT_DIR}}/plugins/YARN/templated/etc/hadoop'

      - service-conf-dir: '{{SERVICE_DIR}}/YARN/sbin'
        templated-dir: '{{DATALIGHT_DIR}}/plugins/YARN/templated/sbin'

    config-event-handler-jar: 'plugins-yarn-1.0.0.jar'
    config-event-handler-clazz: 'cn.boundivore.dl.plugin.yarn.config.event.ConfigEventHandler'

    initialize:
      steps:
        - type: COMMON_SCRIPT
          name: '清理过期的部署环境'
          shell: 'service-remove.sh'
          args: [ ]
          interactions: [ ]
          exits: '0'
          timeout: 10000
          sleep: 0

        - type: COMMON_SCRIPT
          name: '初始化部署服务所需的环境'
          shell: 'service-init-env.sh'
          args: [ ]
          interactions: [ ]
          exits: '0'
          timeout: 60000
          sleep: 0

        - type: JAR
          name: '初始化服务配置文件'
          jar: 'plugins-yarn-1.0.0.jar'
          clazz: 'cn.boundivore.dl.plugin.yarn.config.ConfigYARN'
          args: [ ]
          interactions: [ ]
          exits: '0'
          sleep: 0

    components:
      - name: ResourceManager1
        priority: 1
        max: 1
        min: 1
        mutexes: [ 'ResourceManager2' ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
              - type: SCRIPT
                name: '部署后启动 ResourceManager1'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: START
            steps:
              - type: SCRIPT
                name: '启动 ResourceManager1'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManager', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: STOP
            steps:
              - type: SCRIPT
                name: '停止 ResourceManager1'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'stop' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: RESTART
            steps:
              - type: SCRIPT
                name: '重启 ResourceManager1'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'restart' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

      - name: ResourceManager2
        priority: 2
        max: 1
        min: 1
        mutexes: [ 'ResourceManager1' ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
              - type: SCRIPT
                name: '部署后启动 ResourceManage2'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: START
            steps:
              - type: SCRIPT
                name: '启动 ResourceManage2'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: STOP
            steps:
              - type: SCRIPT
                name: '停止 ResourceManage2'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'stop' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: RESTART
            steps:
              - type: SCRIPT
                name: '重启 ResourceManage2'
                shell: 'yarn-operation.sh'
                args: [ 'ResourceManage', 'restart' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

      - name: NodeManager
        priority: 3
        max: -1
        min: 1
        mutexes: [ ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
              - type: SCRIPT
                name: '部署后启动 NodeManager'
                shell: 'yarn-operation.sh'
                args: [ 'NodeManager', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: START
            steps:
              - type: SCRIPT
                name: '启动 NodeManager'
                shell: 'yarn-operation.sh'
                args: [ 'NodeManager', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: STOP
            steps:
              - type: SCRIPT
                name: '停止 NodeManager'
                shell: 'yarn-operation.sh'
                args: [ 'NodeManager', 'stop' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: RESTART
            steps:
              - type: SCRIPT
                name: '重启 NodeManager'
                shell: 'yarn-operation.sh'
                args: [ 'NodeManager', 'restart' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

      - name: TimelineServer
        priority: 4
        max: 1
        min: 1
        mutexes: [ ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
            - type: SCRIPT
              name: '部署后启动 TimelineServer'
              shell: 'yarn-operation.sh'
              args: [ 'TimelineServer', 'start' ]
              interactions: [ ]
              exits: '0'
              timeout: 60000
              sleep: 1000

          - type: START
            steps:
              - type: SCRIPT
                name: '启动 TimelineServer'
                shell: 'yarn-operation.sh'
                args: [ 'TimelineServer', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: STOP
            steps:
              - type: SCRIPT
                name: '停止 TimelineServer'
                shell: 'yarn-operation.sh'
                args: [ 'TimelineServer', 'stop' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: RESTART
            steps:
              - type: SCRIPT
                name: '重启 TimelineServer'
                shell: 'yarn-operation.sh'
                args: [ 'TimelineServer', 'restart' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

      - name: HistoryServer
        priority: 3
        max: 1
        min: 1
        mutexes: [ ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
              - type: SCRIPT
                name: '部署后启动 HistoryServer'
                shell: 'yarn-operation.sh'
                args: [ 'HistoryServer', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: START
            steps:
              - type: SCRIPT
                name: '启动 HistoryServer'
                shell: 'yarn-operation.sh'
                args: [ 'HistoryServer', 'start' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: STOP
            steps:
              - type: SCRIPT
                name: '停止 HistoryServer'
                shell: 'yarn-operation.sh'
                args: [ 'HistoryServer', 'stop' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

          - type: RESTART
            steps:
              - type: SCRIPT
                name: '重启 HistoryServer'
                shell: 'yarn-operation.sh'
                args: [ 'HistoryServer', 'restart' ]
                interactions: [ ]
                exits: '0'
                timeout: 60000
                sleep: 1000

      - name: YARNClient
        priority: 4
        max: -1
        min: 0
        mutexes: [ ]
        actions:
          - type: DEPLOY
            start-state: DEPLOYING
            success-state: STARTED
            fail-state: SELECTED
            steps:
              - type: COMMAND
                name: '正在完成 Client 部署'
                shell: 'echo done'
                args: [ ]
                interactions: [ ]
                exits: '0'
                sleep: 0
